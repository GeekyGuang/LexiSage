# LexiSage 更新日志

## 版本 0.2.0 - 2026-01-12（架构重构版）  
**“从单点释义到全维解析的进化”**

本次更新是 LexiSage 发布以来最大规模的底层重构，全面支持多字段精细化生成与智能控制。

### 🚀 核心新功能

- **多字段精细化映射（Granular Field Mapping）**  
  支持为每个笔记类型配置任意数量的目标字段，并为每个字段单独设置 Prompt。例如：一次生成即可同时填充 Meaning（中文释义）、Synonyms（同义词辨析）、Grammar（语法点）和 Sentences（场景例句）。

- **智能提示词路由（Smart Prompt Router）**  
  若字段未配置自定义 Prompt，系统将根据字段名（如 `Synonym`、`Grammar`、`Example`）向AI发出默认内置指令。AI人设为“雅思 8 分导师”，涵盖费曼学习法释义、同义词深度辨析等策略。

- **非破坏性更新策略（Non-Destructive Update）**  
  - **更新模式（默认）**：仅填充空字段，跳过已有内容，保护手动编辑数据。  
  - **覆盖模式（新增）**：通过独立“覆盖”按钮强制重写所有目标字段，避免误操作。

- **可视化任务预检（Pre-flight Check）**  
  批量执行前弹出统计窗口，清晰展示：选中笔记数、待填充空字段数、将跳过的非空字段数，消除操作不确定性。

### 🔧 交互与体验改进

- **全新设置界面（UI 2.0）**  
  重写配置 UI，新增“已配置字段列表”视图，支持动态增删字段映射；集成 Prompt 预览功能，可实时查看完整的 JSON Payload 结构。

- **脏数据清洗增强**  
  自动识别并忽略仅含 `&nbsp;`、空格或空 HTML 标签的字段，将其视为真正“空”字段进行填充。

- **按钮布局优化**  
  将高风险的“覆盖”按钮与安全的“更新/取消”按钮物理隔离，显著降低误触风险。

### 🎯 底层架构升级

- **严格 JSON 协议（Strict JSON Protocol）**  
  强制 AI 输出结构化 JSON，彻底解决旧版 Markdown 残留问题，大幅提升多字段回填稳定性。

- **任务扁平化（Task Flattening）**  
  重构多线程 Worker，支持单张笔记内多个字段任务的并发处理，提升批量效率。

- **事务安全机制**  
  引入数据库事务：若操作被取消或发生错误，自动回滚，杜绝“半写入”脏数据。

- **代码整洁化**  
  全面重构变量命名，移除冗余逻辑，显著提升可读性与可维护性。

---

## 版本 0.1.8 - 2024-01-04

### 🚀 新功能
- **多线程批量处理**: 新增多线程支持，批量生成释义速度提升2-3倍
- **智能处理模式**: 根据任务数量自动选择单线程或多线程处理
- **并发数量配置**: 可配置1-10个并发请求，推荐3-5个以获得最佳性能

### 🔧 改进
- **配置界面优化**: 在AI服务设置中新增多线程配置选项
- **进度显示增强**: 多线程处理时显示更详细的进度信息
- **错误处理完善**: 改进多线程环境下的错误处理和用户反馈

### 🎯 技术细节
- 使用 `ThreadPoolExecutor` 实现线程池管理
- 添加 `ProgressTracker` 类进行线程安全的进度跟踪
- 实现 `ExplanationTask` 类封装任务数据
- 保持向后兼容，支持单线程模式

### 📈 性能提升
- 批量处理10个单词：从约25秒减少到约10秒
- 网络延迟越高，多线程优势越明显
- 单个释义生成仍使用单线程（避免不必要开销）

### ⚠️ 注意事项
- 建议并发数量设置为3-5个，过多可能触发API限制
- 初次使用建议先用少量笔记测试
- 如遇到问题可以在设置中关闭多线程功能

---

## 版本 0.1.7 及之前
- 基础AI释义功能
- 支持OpenAI、XAI、DeepSeek等多种AI服务
- 自定义提示词功能
- 多笔记类型支持
